/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details on building Java & JVM projects, please refer to https://docs.gradle.org/9.0.0/userguide/building_java_projects.html in the Gradle documentation.
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    // Use JUnit Jupiter for testing.
    testImplementation libs.junit.jupiter

    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

    // This dependency is used by the application.
    implementation libs.guava

    // Raylib Java bindings for GUI
    implementation libs.jaylib
}

// Apply a specific Java toolchain to ease working on different environments.
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

application {
    // Define the main class for the application.
    mainClass = 'cpe231.finalproject.timelimitedmaze.App'
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
}

tasks.named('run') {
    // macOS requires GUI applications to run on the main thread
    if (System.getProperty("os.name").toLowerCase().contains("mac")) {
        jvmArgs = ['-XstartOnFirstThread']
    }
}

task generic(type: JavaExec) {
    group = 'application'
    description = 'Pre-compute genetic algorithm solutions for all mazes'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'cpe231.finalproject.timelimitedmaze.GAPrecompute'

    doFirst {
        println "Pre-computing genetic algorithm solutions for all mazes..."
    }
}

task profiler(type: JavaExec) {
    group = 'application'
    description = 'Profile solvers on mazes and display results in a table'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'cpe231.finalproject.timelimitedmaze.MazeProfiler'

    if (project.hasProperty('args')) {
        def argString = project.property('args')
        def argList = []
        def currentArg = new StringBuilder()
        def inQuotes = false
        def quoteChar = null

        for (int i = 0; i < argString.length(); i++) {
            char c = argString.charAt(i)
            if ((c == '"' || c == '\'') && (i == 0 || argString.charAt(i - 1) != '\\')) {
                if (inQuotes && c == quoteChar) {
                    inQuotes = false
                    quoteChar = null
                    if (currentArg.length() > 0) {
                        argList.add(currentArg.toString())
                        currentArg = new StringBuilder()
                    }
                } else if (!inQuotes) {
                    inQuotes = true
                    quoteChar = c
                }
            } else if (c == ' ' && !inQuotes) {
                if (currentArg.length() > 0) {
                    argList.add(currentArg.toString())
                    currentArg = new StringBuilder()
                }
            } else {
                currentArg.append(c)
            }
        }
        if (currentArg.length() > 0) {
            argList.add(currentArg.toString())
        }
        args argList
    }

    doFirst {
        println "Running maze solver profiler..."
    }
}

task animation(type: JavaExec) {
    group = 'application'
    description = 'Run GA Animation GUI to visualize genetic algorithm evolution'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'cpe231.finalproject.timelimitedmaze.gui.GAAnimation'

    // macOS requires GUI applications to run on the main thread
    if (System.getProperty("os.name").toLowerCase().contains("mac")) {
        jvmArgs = ['-XstartOnFirstThread']
    }

    doFirst {
        println "Starting GA Animation GUI..."
    }
}
